#include <Servo.h>
int TRIG_blue  = 10; 
int ECHO_pink  = 9;  
int SERVO_orange = 3;  
Servo servo;
long duration = 0;
long cm =  0;
int state = 0;
int timer = 0;

void setup() {      
  pinMode(TRIG_blue, OUTPUT); 
  pinMode(ECHO_pink, INPUT);  
  servo.attach(SERVO_orange);   
  servo.write(180);
  Serial.begin(9600);
  state = 1; // Open
  timer = 0;

}

void loop() {

  digitalWrite(TRIG_blue, HIGH);
  delayMicroseconds(100);
  digitalWrite(TRIG_blue, LOW);
  
  duration = pulseIn(ECHO_pink, HIGH);
  cm = (duration/2)/28.5;
  Serial.println(" cm:");
  Serial.println(cm);
  
  
  // While lowering and about to close claw
  if (cm <= 10){
    if (state == 1){
      state = 2; // Closed
      timer = 0;
    }
  }
  
  // Wait to see if were still down on the object
  if (state == 2){
    if (cm <= 10){
      timer ++;
      if (timer >= 5){ // How long to wait until we close the claw
        servo.write(0);
        state = 3;
        timer = 0;
      }
    
    }
    // If we go back up, then reset the cycle
    else{
      state = 1;
    }
  }
 
  
  // While closed and transfering objects
  if (state == 3){
    timer ++;
    if (timer >= 15){ // How long to wait until we allow the claw to open
      if (cm <= 10){ 
        servo.write(180);
        state = 4; // Cooldown
        timer = 0;
      }
    }
  }
  
  // Cooldown
  if (state == 4){
    timer ++;
    if (timer >= 10){ // How long we wait before resettting the cycle
      state = 1;
      timer = 0;
    }
  }
  
  Serial.println(" Timer: ");
  Serial.println(timer);
  Serial.println(" State:");
  Serial.println(state);

/*
  if(cm <= 10){
    for (int i = 180*3; i >= 0; i--){
      if (i % 3 == 0){  
        Serial.print(i);
        servo.write(i/3); 
        Serial.print(" degree:");
      }
    }  
  }

  else if(cm >= 20){
    for (int i = 0; i <= 180*3; i++){
      if (i % 3 == 0){  
        Serial.print(i);
        servo.write(i/3); 
        Serial.print(" degree:");
      }
    }
  }

 */
  
/*
  if (cm < 10){
    servo.write(0);
  }

  else if (cm > 20){
    servo.write(180);
  }
  */
  
  delay (500);
}
